<HTML>
<head>
<LINK REL=StyleSheet HREF="css/stupid.css" TYPE="text/css" MEDIA=screen>
<script src="js/d3.v3.min.js" charset="utf-8"></script>
<script type="text/javascript">
  function update_circles(data) {
var svg = d3.select("svg");
    svg.selectAll("circle")
    .data(data)
    .enter().append("circle")
    .style("fill", "steelblue")
    .attr("r", 5)
    .transition().attr("cx", function(d) { return d[1]*5; })
    .transition().attr("cy", function(d) { return d[2]*5; });
}
</script>
<script type="text/javascript">  
  socket= new WebSocket('ws://localhost:8080/websocket');
  socket.onopen= function() {
    socket.send("initial");
    };
  socket.onmessage = function(s) {
    var keys = [];
    for ( var key in s ) {
      keys.push(key) 
    };
    var data = JSON.parse(s.data);
    update_circles(data);
  };
</script>
<body>
<!--
TODO: the hardcoded values for svg.width and svg.height need to be dynamicly
set by data from the socket
-->
<svg width="1125" height="1125">

</svg>
<script type="text/javascript">
  // This sends the "update" message to the socket every 1000ms
  // and updates the circles with the recived data
  setInterval(function() {socket.send("update")},1000);
  socket.onmessage = function(t) {
    var keys = [];
    for ( var key in t ) {
      keys.push(key) 
    }
    var updatedata = JSON.parse(t.data);
    update_circles(updatedata);
  };
</script>
</body>


<script type="text/javascript">
</script>
</HTML>
